import Head from "next/head";
import { useState, useEffect } from "react";
import { useDispatch } from "react-redux";
import styles from "../styles/Home.module.css";
import NavBar from "./components/NavBar";
import {
  Container,
  Box,
  styled,
  Grid,
  FormControl,
  InputLabel,
  Input,
  InputAdornment,
  TextField,
  Button,
  MenuItem,
  Typography,
} from "@mui/material";

import MyFooter from "./components/MyFooter";
import { setErrorState, setLoadingState } from "../app/rootSlice";
import message from "../common/messages";
import { Controller, useForm } from "react-hook-form";
import { Product } from "../interfaces/entity/product";
const StyledBox = styled(Box)(({ theme }) => ({
  backgroundColor: "white",
  borderRadius: 5,
  padding: 18,
}));

const StyledTitle = styled(Typography)(({ theme }) => ({
  variant: "h5",
  align: "center",
  color: "#008B88",
}));

type InputCardGame = {
  game: string;
};

function Home() {
  const dispatch = useDispatch();
  const [products, setProducts] = useState<Product[]>([]);
  const { control, handleSubmit, reset, register, watch } = useForm({
    // resolver: ajvResolver(schema),
  });
  const watchShowGame = watch("game", false); // you can supply default value as second argument
  const [inputCardGame, setInputCardGame] = useState<InputCardGame>();

  useEffect(() => {
    dispatch(
      setLoadingState({
        loading: true,
        loadingMessage: message.appAPILoading,
      })
    );
    fetch("/api/public/card-games")
      .then((response) => response.json())
      .then((data) => {
        if (data.error === true) {
          dispatch(
            setErrorState({
              message: data.message,
              values: "",
              severity: "error",
            })
          );
        } else {
          setProducts(data);
        }
      })
      .finally(() => {
        dispatch(
          setLoadingState({
            loading: false,
            loadingMessage: null,
          })
        );
      });
  }, [dispatch]);

  const onSubmit = (data: object) => {
    dispatch(
      setLoadingState({
        loading: true,
        loadingMessage: message.appAPILoading,
      })
    );
    fetch("/api/product-item", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        ...data,
      }),
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.error === true) {
          dispatch(
            setErrorState({
              message: data.message,
              values: "",
              severity: "error",
            })
          );
        }
      })
      .finally(() => {
        dispatch(
          setLoadingState({
            loading: false,
            loadingMessage: null,
          })
        );
      });
  };

  const renderPackage = (activeProductId: string) => {
    const product = products.find((i) => i.id === activeProductId);
    console.log("product", product);
    const productItems = product?.productItems || [
      {
        id: "id",
        name: "No data",
      },
    ];
    return productItems.map((option) => (
      <MenuItem key={option.id} value={option.id}>
        {option.name}
      </MenuItem>
    ));
  };

  return (
    <div className={styles.container}>
      <Head>
        <title>Mua bÃ¡n account games</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <NavBar></NavBar>

      <Container style={{ marginTop: 10 }}>
        <StyledBox>
          <Grid container>
            <Grid item xs={12} sm={6} md={6} lg={6} xl={6}>
              <StyledTitle variant="h5" align="center" color="#008B88">
                Nháº­p thÃ´ng tin Náº P GENSHIN IMPACT
              </StyledTitle>
              <form onSubmit={handleSubmit(onSubmit)} autoComplete="off">
                <Controller
                  name="game"
                  control={control}
                  render={({
                    field: { onChange, value },
                    fieldState: { error },
                  }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        id="outlined-multiline-flexible"
                        label="Game"
                        select={true}
                        onChange={onChange}
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      >
                        {products.map((option) => (
                          <MenuItem key={option.id} value={option.id}>
                            {option.name}
                          </MenuItem>
                        ))}
                      </TextField>
                    </FormControl>
                  )}
                />
                <Controller
                  name="package"
                  control={control}
                  render={({
                    field: { onChange, value },
                    fieldState: { error },
                  }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        id="outlined-multiline-flexible"
                        label="GÃ³i"
                        select={watchShowGame ? true : false}
                        onChange={onChange}
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      >
                        {watchShowGame && renderPackage(watchShowGame)}
                      </TextField>
                    </FormControl>
                  )}
                />
                <Controller
                  name="accountId"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="User ID"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      />
                    </FormControl>
                  )}
                />

                <Controller
                  name="accountName"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="TÃªn tÃ i khoáº£n"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                        inputProps={{ min: 1000 }}
                      />
                    </FormControl>
                  )}
                />

                <Controller
                  name="accountPassword"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="Máº­t kháº©u"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      />
                    </FormControl>
                  )}
                />
                <Controller
                  name="server"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="Server"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      />
                    </FormControl>
                  )}
                />
                <Controller
                  name="characterName"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="TÃªn nhÃ¢n váº­t"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      />
                    </FormControl>
                  )}
                />
                <Controller
                  name="phoneNumber"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="Sá»‘ Ä‘iá»‡n thoáº¡i"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      />
                    </FormControl>
                  )}
                />
                <Controller
                  name="description"
                  control={control}
                  render={({ field, fieldState: { error } }) => (
                    <FormControl fullWidth sx={{ m: 1 }} variant="standard">
                      <TextField
                        {...field}
                        id="outlined-multiline-flexible"
                        label="Ghi chÃº"
                        variant="filled"
                        size="small"
                        error={error ? true : false}
                        helperText={error?.message}
                      />
                    </FormControl>
                  )}
                />
                <Button
                  variant="contained"
                  color="primary"
                  style={{
                    margin: 4,
                    alignItems: "center",
                    alignContent: "center",
                    textAlign: "center",
                  }}
                  type="submit"
                >
                  Gá»­i yÃªu cáº§u
                </Button>
              </form>
            </Grid>
            <Grid item xs={12} sm={6} md={6} lg={6} xl={6}>
              <StyledTitle variant="h5" align="center" color="#008B88">
                HÆ°á»›ng dáº«n Náº P GENSHIN IMPACT
              </StyledTitle>
              <Box p={2}>
                <Typography style={{ backgroundColor: "red", color: "yellow" }}>
                  ğŸ“› GiÃ¡ náº¡p hiá»‡n Ä‘Ã£ á»•n Ä‘á»‹nh cÃ¡c báº¡n nÃªn Ä‘Æ¡n ok nhÃ©
                </Typography>
                <Typography
                  style={{
                    color: "red",
                    textTransform: "uppercase",
                    fontWeight: "bold",
                  }}
                >
                  BÃ€I CÃC CÃ‚U Há»I Vá»€ Náº P:
                </Typography>
                <Typography
                  style={{
                    color: "red",
                    fontWeight: "bold",
                  }}
                >
                  Link check tÃ i khoáº£n Ä‘Ãºng hay chÆ°a
                </Typography>
                <Typography
                  style={{
                    backgroundColor: "yellow",
                    fontWeight: "bold",
                  }}
                >
                  https://account.mihoyo.com/#/account/loginDevices
                </Typography>
                <Typography style={{ backgroundColor: "red", color: "yellow" }}>
                  ğŸ“›ÄÆ¡n náº¡p khi nÃªn khÃ´ng thá»ƒ xong Ä‘Æ°á»£c ngay cáº§n Ä‘á»£i xá»­ lÃ½
                </Typography>
                <Typography style={{ backgroundColor: "red", color: "yellow" }}>
                  ğŸ“›Náº¿u Ä‘Æ¡n há»§y tiá»n sáº½ Ä‘Æ°á»£c hoÃ n vá» tÃ i khoáº£n cÃ¡c báº¡n
                </Typography>
                <Typography style={{}}>
                  ğŸ“›TÃ i khoáº£n vÃ  máº­t kháº©u nÃªn Ä‘Æ¡n pháº£i lÃ  tÃ i khoáº£n Mihoyo ko
                  lÃªn = FB - Google<br></br>
                  ğŸ“›UID lÃ  UID cÃ¡c báº¡n váº«n dÃ¹ng káº¿t báº¡n<br></br>
                  ğŸ“›CÃ¡c gÃ³i náº¡p chÆ°a tÃ­nh x2 náº¿u cÃ³ <br></br>
                  ğŸ“› HÃ£y cung cáº¥p mÃ£ Ä‘Äƒng nháº­p khi shop liÃªn há»‡ láº¥y mÃ£ login
                  trong thÆ° maill <br></br>
                  ğŸ“› Náº¿u khÃ´ng cÃ³ SÄT hÃ£y Ä‘iá»n link fb hoáº·c zalo á»Ÿ má»¥c ghi chÃº
                </Typography>

                <Typography style={{ backgroundColor: "red", color: "yellow" }}>
                  ğŸ“› Má»™t sá»‘ lÃ½ do khi Ä‘Æ¡n cá»§a báº¡n bá»‹ há»§y
                </Typography>
                <Typography>
                  - Sai tÃ i khoáº£n hoáº·c máº­t kháº©u <br></br>- Sá»‘ Ä‘iá»‡n thoáº¡i khÃ´ng
                  liÃªn há»‡ Ä‘Æ°á»£c <br></br>- Call nhÆ°ng khÃ´ng nghe mÃ¡y <br></br>-
                  KhÃ´ng náº¡p tÃ i khoáº£n Facebook
                </Typography>
                <Typography style={{}}>ğŸ“› Báº£o hÃ nh náº¡p 100%</Typography>
                <Typography style={{}}>
                  ğŸ“› Má»i thÃ´ng tin náº¡p náº¿u khÃ´ng hiá»ƒu hÃ£y ib cho Fanpage
                </Typography>
                <Typography style={{ backgroundColor: "red", color: "yellow" }}>
                  â‡ï¸ LÆ°u Ã½ : Khi náº¡p thÃ nh cÃ´ng Ä‘Æ¡n hÃ£y Ä‘á»•i máº­t kháº©u Ä‘á»ƒ Ä‘áº£m báº£o
                  an toÃ n !
                </Typography>
              </Box>
            </Grid>
          </Grid>
        </StyledBox>
      </Container>

      <MyFooter />
    </div>
  );
}

export default Home;
